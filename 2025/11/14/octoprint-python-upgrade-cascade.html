<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>We Therefore do not Recommend this Approach (to Upgrading OctoPrint's Python)</title>
<!-- Begin Jekyll SEO tag v2.8.0 --> <meta name="generator" content="Jekyll v4.4.1"> <meta property="og:title" content="We Therefore do not Recommend this Approach (to Upgrading OctoPrint‚Äôs Python)"> <meta name="author" content="Texarkanine"> <meta property="og:locale" content="en_US"> <meta name="description" content="The Warning"> <meta property="og:description" content="The Warning"> <link rel="canonical" href="https://blog.cani.ne.jp/2025/11/14/octoprint-python-upgrade-cascade.html"> <meta property="og:url" content="https://blog.cani.ne.jp/2025/11/14/octoprint-python-upgrade-cascade.html"> <meta property="og:site_name" content="üê∂ Dog with a Dev Blog"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2025-11-14T00:00:00+00:00"> <meta name="twitter:card" content="summary"> <meta property="twitter:title" content="We Therefore do not Recommend this Approach (to Upgrading OctoPrint‚Äôs Python)"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Texarkanine"},"dateModified":"2025-11-14T00:00:00+00:00","datePublished":"2025-11-14T00:00:00+00:00","description":"The Warning","headline":"We Therefore do not Recommend this Approach (to Upgrading OctoPrint‚Äôs Python)","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.cani.ne.jp/2025/11/14/octoprint-python-upgrade-cascade.html"},"url":"https://blog.cani.ne.jp/2025/11/14/octoprint-python-upgrade-cascade.html"}</script> <!-- End Jekyll SEO tag --> <link type="application/atom+xml" rel="alternate" href="https://blog.cani.ne.jp/feed.xml" title="üê∂ Dog with a Dev Blog">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.css" integrity="sha384-OH8qNTHoMMVNVcKdKewlipV4SErXqccxxlg6HC9Cwjr5oZu2AdBej1TndeCirael" crossorigin="anonymous"> </head> <body a="light"> <main class="page-content" aria-label="Content"> <div class="w"> <p> <a href="/">~</a> / <a href="/all-posts.html">..</a> </p> <header> <h1>We Therefore do not Recommend this Approach (to Upgrading OctoPrint's Python)</h1> <div style="display: flex; justify-content: space-between; align-items: center;"> <div> <span> a <a href="/categories/diary/">diary</a> </span> <span> by <a href="/authors/texarkanine/">texarkanine</a> </span> </div> <div> <span class="post-meta">2025-11-14</span> </div> </div> </header> <article> <h2 id="the-warning">The Warning</h2> <p>OctoPrint on my Raspberry Pi 4 greeted me with an ominous warning: my Python environment was outdated and would soon be unsupported. The message linked to <a href="https://community.octoprint.org/t/octoprint-tells-me-my-python-environment-is-outdated-and-will-soon-no-longer-be-supported-how-do-i-upgrade/61076" target="_blank" rel="noopener">the OctoPrint community‚Äôs upgrade guide</a>, which outlined the proper upgrade path. Simple enough, I thought. I‚Äôd just build a newer Python and upgrade in place, like they tell you not to:</p> <blockquote> <p>Instead of reflashing or running a dist-upgrade, you might be tempted to upgrade your Python installation by compiling Python yourself. On anything but a Raspberry Pi, that is fine. <br>‚Ä¶<br> We therefore do not recommend this approach unless you really know what you are doing.</p> </blockquote> <p>Well, I work in <strong>Big Tech</strong> for my day job and I know how to Python, so they‚Äôre totally talking about me there‚Ä¶ right?</p> <h2 id="the-python-journey">The Python Journey</h2> <p>I installed <code class="language-plaintext highlighter-rouge">pyenv</code> and built Python 3.14, only to discover that OctoPrint doesn‚Äôt support it yet. Oops, should‚Äôve RTFM‚Äôm. No problem - I built Python 3.13 instead, which falls within OctoPrint‚Äôs supported range.</p> <p>The OctoPrint community guide said you could use the <code class="language-plaintext highlighter-rouge">octoprint-venv-tool</code> to recreate the virtual environment with a new Python version. I followed the steps, rebuilt the venv, and restarted OctoPrint.</p> <p>Then came the error:</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>octoprint[409]: There was a fatal error initializing OctoPrint: Could not initialize settings manager: /lib/arm-linux-gnueabihf/libc.so.6: version `GLIBC_2.34' not found (required by /home/pi/oprint/lib/python3.13/site-packages/netifaces.cpython-313-arm-linux-gnueabihf.so)
</code></pre></div></div> <h2 id="the-glibc-problem">The GLIBC Problem</h2> <p>The <code class="language-plaintext highlighter-rouge">netifaces</code> package, compiled against Python 3.13, required GLIBC 2.34. I tried the solution from <a href="https://community.octoprint.org/t/upgraded-octoprint-new-glibc-dependency-broken/64705/9" target="_blank" rel="noopener">a related community thread</a> that suggested adjusting the <code class="language-plaintext highlighter-rouge">psutil</code> package, but that didn‚Äôt help. The problem wasn‚Äôt specific to one package - it was systemic.</p> <p>I checked the <a href="https://packages.debian.org/search?searchon=names&amp;keywords=libc6" target="_blank" rel="noopener">Debian package listings for libc6</a>. My Raspberry Pi was running Debian Bullseye, which tops out at GLIBC 2.31. Debian Bookworm, however, includes versions up to 2.36. That‚Äôd work!</p> <p>This left me with three options:</p> <ol> <li>attempt to install Bookworm‚Äôs GLIBC on Bullseye (risky and likely to cause other dependency issues)</li> <li>upgrade the entire system to Bookworm</li> <li>abort and do a backup of OctoPrint and a fresh install + restore</li> </ol> <p>Obviously, I chose the upgrade the entire system to Bookworm because as we already established, I know what I‚Äôm doing.</p> <h2 id="the-debian-upgrade">The Debian Upgrade</h2> <p>I followed <a href="https://linuxcapable.com/how-to-upgrade-from-debian-11-bullseye-to-debian-12-bookworm/" target="_blank" rel="noopener">some upgrade guide from Bullseye to Bookworm</a>, which seemed legit. The process was straightforward, though I encountered numerous configuration file prompts - the classic ‚Äúdo you want to keep your version or use the package maintainer‚Äôs version?‚Äù question, e.g.</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Configuration file '/etc/haproxy/haproxy.cfg'
==&gt; Modified (by you or by a script) since installation.
==&gt; Package distributor has shipped an updated version.
  What would you like to do about it ?  Your options are:
   Y or I  : install the package maintainer's version
   N or O  : keep your currently-installed version
     D     : show the differences between the versions
     Z     : start a shell to examine the situation
The default action is to keep your current version.
*** haproxy.cfg (Y/I/N/O/D/Z) [default=N] ?
</code></pre></div></div> <p>After reviewing several and finding them harmless, I stopped scrutinizing each one.</p> <p>The upgrade completed successfully. OctoPrint started without the GLIBC error. Victory, right?</p> <h2 id="its-almost-like-they-thought-of-this">It‚Äôs Almost Like They Thought Of This</h2> <p>Not quite. The OctoPrint web interface was no longer accessible on port 80.</p> <p>It turns out OctoPi (the Raspberry Pi distribution for OctoPrint) uses HAProxy to proxy the web interface to port 80. During the upgrade, I had accepted the package maintainer‚Äôs version of the HAProxy configuration, which overwrote OctoPi‚Äôs custom setup with the generic default.</p> <p>Fortunately, Debian‚Äôs upgrade process saves old configuration files with the <code class="language-plaintext highlighter-rouge">.dpkg-old</code> suffix. I navigated to <code class="language-plaintext highlighter-rouge">/etc/haproxy</code> and ran:</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp </span>haproxy.cfg.dpkg-old haproxy.cfg
</code></pre></div></div> <p>I verified this by comparing it against <a href="https://github.com/guysoft/OctoPi/blob/devel/src/modules/octopi/filesystem/root/etc/haproxy/haproxy.2.x.cfg" target="_blank" rel="noopener">the HAProxy configuration in the OctoPi repository</a>. The configs were similar-enough that I concluded I was on the right track.</p> <p>After restarting HAProxy, the web interface came back on port 80. OctoPrint was now running Python 3.13, no longer complaining about end-of-life‚Äôd Python 3.9.</p> <h2 id="the-cascade">The Cascade</h2> <p>I started with a simple goal: upgrade Python in OctoPrint. What I got was:</p> <ol> <li>Build Python 3.14 (wrong version)</li> <li>Build Python 3.13 (correct version)</li> <li>Recreate OctoPrint‚Äôs virtual environment</li> <li>Discover GLIBC incompatibility</li> <li>Upgrade the entire operating system from Debian 11 to Debian 12</li> <li>Restore the HAProxy configuration</li> </ol> <p>This is what <del>dependency chains</del> yak shaving looks like in practice. Python 3.13 requires GLIBC 2.34. GLIBC 2.34 isn‚Äôt available in Bullseye. Upgrading to Bookworm provides GLIBC 2.34 but replaces your configuration files if you slack off. Each step seems reasonable in isolation, but together they form a cascade where a ‚Äúsimple‚Äù upgrade of a venv‚Äôs Python necessitates an OS upgrade.</p> <p>The lesson here isn‚Äôt to avoid upgrades - quite the opposite. Staying on outdated software just accumulates technical debt, making the eventual upgrade more painful. The lesson is to expect the cascade and be prepared for it.</p> <p>So, like, use pyenv and venvs, but‚Ä¶ don‚Äôt forget that it all sits on a throne of lies and you‚Äôll need to upgrade your whole system to be able to build a natively-compiled extension for your interpreted language, anyway.</p> <p>The next time OctoPrint warns me about an outdated component, I‚Äôll know to check the entire dependency stack before starting. And I‚Äôll be more careful about which configuration files I let the package manager overwrite. Haha - just kidding! Remember, after all‚Ä¶ I know what I‚Äôm doing ;)</p> </article> <footer> <p> tagged: <a href="/tags/3d-printing/">3d-printing</a>, <a href="/tags/debian/">debian</a>, <a href="/tags/glibc/">glibc</a>, <a href="/tags/haproxy/">haproxy</a>, <a href="/tags/octopi/">octopi</a>, <a href="/tags/octoprint/">octoprint</a>, <a href="/tags/python/">python</a>, <a href="/tags/raspberry-pi/">raspberry-pi</a> </p> </footer> <p> <a href="/">~</a> / <a href="/all-posts.html">..</a> </p> </div> </main> <footer> <a href="bitcoin:PM8TJf1vjyABc9bzymdixNhP9CUCDWSM6QEx2WbSf9gtgodZMuEdKHDYumhCdqJSEVFPTtZ3wcZiYravDcCyX848MZ9TgcMoNteo71ardqbNMsJb4BNg" target="_blank" rel="noopener noreferrer" class="call-me-bip-me-if-you-need-to-reach-me" aria-label="Support Me: BIP47 Payment Code"></a> </footer> </body> </html>
