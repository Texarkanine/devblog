<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <meta name="viewport" content="width=device-width, initial-scale=1"> <title>Look at this Dog</title>
<!-- Begin Jekyll SEO tag v2.8.0 --> <meta name="generator" content="Jekyll v4.4.1"> <meta property="og:title" content="Look at this Dog"> <meta name="author" content="Texarkanine"> <meta property="og:locale" content="en_US"> <meta name="description" content="On the internet, nobody knows you‚Äôre a dog and a cat in a latent space."> <meta property="og:description" content="On the internet, nobody knows you‚Äôre a dog and a cat in a latent space."> <link rel="canonical" href="https://blog.cani.ne.jp/2025/11/25/look-at-this-dog.html"> <meta property="og:url" content="https://blog.cani.ne.jp/2025/11/25/look-at-this-dog.html"> <meta property="og:site_name" content="üê∂ Dog with a Dev Blog"> <meta property="og:type" content="article"> <meta property="article:published_time" content="2025-11-25T00:00:00+00:00"> <meta name="twitter:card" content="summary"> <meta property="twitter:title" content="Look at this Dog"> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Texarkanine"},"dateModified":"2025-11-25T00:00:00+00:00","datePublished":"2025-11-25T00:00:00+00:00","description":"On the internet, nobody knows you‚Äôre a dog and a cat in a latent space.","headline":"Look at this Dog","mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.cani.ne.jp/2025/11/25/look-at-this-dog.html"},"url":"https://blog.cani.ne.jp/2025/11/25/look-at-this-dog.html"}</script> <!-- End Jekyll SEO tag --> <link type="application/atom+xml" rel="alternate" href="https://blog.cani.ne.jp/feed.xml" title="üê∂ Dog with a Dev Blog">
<link rel="shortcut icon" type="image/x-icon" href="/favicon.ico"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.9/dist/katex.css" integrity="sha384-OH8qNTHoMMVNVcKdKewlipV4SErXqccxxlg6HC9Cwjr5oZu2AdBej1TndeCirael" crossorigin="anonymous"> </head> <body a="light"> <main class="page-content" aria-label="Content"> <div class="w"> <p> <a href="/">~</a> / <a href="/all-posts.html">..</a> </p> <header> <h1>Look at this Dog</h1> <div style="display: flex; justify-content: space-between; align-items: center;"> <div> <span> a <a href="/categories/record/">record</a> </span> <span> by <a href="/authors/texarkanine/">texarkanine</a> </span> </div> <div> <span class="post-meta">2025-11-25</span> </div> </div> </header> <article> <p><a href="/assets/img/blog/record/thisdog.jpg" target="_blank" rel="noopener"><img height="400" src="/assets/img/blog/record/thisdog_thumb-a50de5-300x400.jpg" alt="Look at this dog" loading="lazy"></a></p> <hr> <p>Now look back at me.</p> <p>Did you look at the dog? I can‚Äôt tell, because that image isn‚Äôt loaded through the <a href="/2025/11/23/opensearch-for-static-site-logs.html">nginx reverse-proxy that sits in front of the blog to provide metrics</a>.</p> <p>Why, though?</p> <blockquote> <p>I want to minimize the usage of resource-constrained and metered cloud resources involved in serving a page.</p> </blockquote> <p>The metrics-enabling nginx reverse-proxy was built before there were any images or other media posted here; it only had to serve text. However, adding media and doing nothing else could now potentially take up significant <em>metered</em> DigitalOcean compute and bandwidth on the nginx instance. For a <em>static site</em>, that seems even goofier than the nginx metrics solution already was.</p> <p>I had several options:</p> <h2 id="option-1-separate-app--jekyll-rewrite">Option 1: Separate App &amp; Jekyll Rewrite</h2> <p>I could deploy the site a second time to a different DigitalOcean App Engine App w/ a static site, something like <code class="language-plaintext highlighter-rouge">dogblog-media-XXXX.ondigitalocean.app</code>. Then, I could have Jekyll render the base url as a prefix when rendering <code class="language-plaintext highlighter-rouge">&lt;img&gt;</code> tags, giving</p> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;img src="https://dogblog-media-XXX.ondigitalocean.app/path/to/img.jpg"&gt;
</code></pre></div></div> <p>instead of a relative url.</p> <p><strong>BUT</strong></p> <ol> <li>This would be a ‚Äúcross-origin‚Äù request, and some browsers or situations might not care for that.</li> <li>If I ever changed the image host URL, cached versions of the site (or others‚Äô links to the images) could break.</li> <li>I‚Äôd have to add a rule to the nginx to block <code class="language-plaintext highlighter-rouge">/assets</code> requests on the main site.</li> </ol> <h2 id="option-2-separate-app--nginx-rewrite">Option 2: Separate App &amp; nginx Rewrite</h2> <p>I could deploy the site a second time as before, but have the nginx intercept the <code class="language-plaintext highlighter-rouge">/assets</code> path on the main domain and return an HTTP 3XX redirect.</p> <p>This would also give me metrics on media requests!</p> <p><strong>BUT</strong></p> <ol> <li>I‚Äôm still adding traffic to the nginx, and my inital goal was to reduce it!</li> <li>There‚Äôs still ultimately a cross-domain situation, though the request path is slightly less sketchy.</li> <li>If I ever changed the image host URL, cached versions of the site (or others‚Äô links to the images) could break.</li> </ol> <h2 id="option-3-same-app-separate-site">Option 3: Same App, Separate Site</h2> <p>I could deploy the site a second time into the same DigitalOcean App Engine App, and bind it to the <code class="language-plaintext highlighter-rouge">/assets</code> path. This will cause DigitalOcean‚Äôs gateway (which is front of my nginx) to intercept requests to <code class="language-plaintext highlighter-rouge">/assets</code> and route them to the second static site. This happens <em>behind</em> the main blog domain name; no secondary URLs involved!</p> <p>This second site would be built off the <code class="language-plaintext highlighter-rouge">/assets</code> subdirectory so it could not possibly serve normal pages. Additional protection against serving normal pages comes from it being part of the main blog App: all paths <em>other</em> than <code class="language-plaintext highlighter-rouge">/assets</code> are routed by DigitalOcean to my nginx, which serves normal pages from their proper place.</p> <p>Additionally, DigitalOcean‚Äôs gateway is already routing all non-<code class="language-plaintext highlighter-rouge">/assets</code> requests to my nginx - thus saving me from having to add an explicit rule preventing the secondary domain from incorrectly serving them without metrics.</p> <p>That‚Äôs much simpler, and that‚Äôs what I did!</p> <hr> <p>This setup does <em>not</em> get me metrics on media asset requests, but I can live with that. I‚Äôm building a blog, not a media host, after all.</p> </article> <footer> <p> tagged: <a href="/tags/jekyll/">jekyll</a>, <a href="/tags/digitalocean/">digitalocean</a>, <a href="/tags/cdn/">cdn</a> </p> </footer> <p> <a href="/">~</a> / <a href="/all-posts.html">..</a> </p> </div> </main> <footer> <a href="bitcoin:PM8TJf1vjyABc9bzymdixNhP9CUCDWSM6QEx2WbSf9gtgodZMuEdKHDYumhCdqJSEVFPTtZ3wcZiYravDcCyX848MZ9TgcMoNteo71ardqbNMsJb4BNg" target="_blank" rel="noopener noreferrer" class="call-me-bip-me-if-you-need-to-reach-me" aria-label="Support Me: BIP47 Payment Code"></a> </footer> </body> </html>
