{%-comment-%}Compute shuffled garden once if needed (for shuffle branch or default){%-endcomment-%}
{%-unless include.sort_key-%}
  {%-assign garden_size = site.garden | size-%}
  {%-if garden_size > 1-%}
    {%-assign shuffled_garden = site.garden | sample: garden_size-%}
  {%-else-%}
    {%-assign shuffled_garden = site.garden-%}
  {%-endif-%}
{%-endunless-%}

{%-if include.shuffle-%}
  {%-assign sorted_garden = shuffled_garden-%}
{%-elsif include.sort_key-%}
  {%-assign sorted_garden = site.garden | sort: include.sort_key-%}
  {%-if include.reverse-%}
    {%-assign sorted_garden = sorted_garden | reverse-%}
  {%-endif-%}
{%-else-%}
  {%-comment-%}Default: shuffle{%-endcomment-%}
  {%-assign sorted_garden = shuffled_garden-%}
{%-endif-%}

{%- if sorted_garden.size > 0 -%}
  <ul>
    {%- for post in sorted_garden limit: include.limit -%}
        <li>
          {% if site.theme_config.lowercase_titles == true %}
          <a href="{{ post.url | relative_url }}">{{ post.title | downcase }}</a>
          {% else %}
          <a href="{{ post.url | relative_url }}">{{ post.title }}</a>
          {% endif %}
        </li>
    {%- endfor -%}
  </ul>
{%- endif -%}
